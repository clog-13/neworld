# 电商系统是如何设计的

**在需求还不太明确的情况下，比较可行的方式就是，先把那些不太会变化的核心系统搭建出来，尽量简单地实现出一个最小化的系统，然后再逐步迭代完善。**

## 电商系统的核心流程是什么样的

不要一上来就设计功能，而是先要回答下面这两个问题：

这个系统（或者是功能）是给哪些人用的？

这些人使用这个系统来解决什么问题？

这两个问题的答案，我把它们称为**业务需求**。在我们将要设计的这个电商系统中，它的业务需求是什么？

第一个问题，电商系统给哪些人用？

首先得有买东西的人，我们叫“用户”，还得有卖东西的人？我们叫“运营人员”。还有什么人会用这个系统？老板啊！你记住，你在设计任何一个系统的时候，千万不要把老板或者是领导给忘了，他们是给你钱的人，他们的意见非常重要！

然后我们一起回答第二个问题：用户、运营和老板，分别用电商系统来干什么？

这个问题也很容易回答，用户用系统来买东西，运营用系统来卖东西，老板需要在系统中看到他赚了多少钱。这两个问题的答案，或者说是业务需求，稍加细化后，可以用下面这个图来清晰的表述：

![](https://tva1.sinaimg.cn/large/006DIypxly1h5nqkszmfxj30pz0cvwgj.jpg)

这个图在 UML（统一建模语言）中称为用例图（Use Case），是需求分析的时候你需要画的第一张图。它回答的就是，业务需求中的那两个关键的问题，这个系统给谁用？他们用这个系统解决什么问题？

一般来说，业务需求和我们要设计的系统关系不大。为什么这么说呢？你可以看一下上面这个图里面的用例，放在传统的商业企业里面，比如一个小杂货铺、一个线下实体商场商店或者一个做电视购物的公司，是不是也是适用的？所以做业务需求的主要目的，是理清楚业务场景是什么样的。

然后我们来分析电商系统的流程。显然，一个电商系统最主要的业务流程，一定是购物这个流程。你应该很容易就能把这个流程分析出来，它的流程图是这样的：

![](https://tva1.sinaimg.cn/large/006DIypxly1h5nqlgxykxj30yi0a1gmt.jpg)

流程从用户选购商品开始，用户先从你的 App 中浏览商品；找到心仪的商品之后，把商品添加到购物车里面；都选好了之后，打开购物车，下一个订单；下单结算之后，就可以支付了；支付成功后，运营人员接下来会给每个已经支付的订单发货；邮寄商品给用户之后，用户确认收货，到这里一个完整的购物流程就结束了。

## 如何根据流程来划分功能模块

细化之后的流程，绘制成了下面这个时序图（Sequence Diagram）：

![](https://tva1.sinaimg.cn/large/006DIypxly1h5nqm7z0ksj31250kgtcc.jpg)

用户开始浏览商品，需要有一个**商品模块**来支撑，给用户展示商品的介绍、价格等等这些信息。

用户把选好的商品加入购物车，这个步骤，也需要一个**购物车模块**来维护用户购物车中的商品。

用户下单肯定需要一个**订单模块**来创建这个新订单。订单创建好了之后，需要把订单中的商品从购物车中删除掉。

订单创建完成后，需要引导用户付款，也就是发起支付流程，这里需要有一个**支付模块**来实现支付功能，用户成功完成支付之后，需要把订单的状态变更为“已支付”。

之后运营人员就可以发货了，在系统中，发货这个步骤，需要扣减对应商品的库存数量，这个功能需要**库存模块**来实现，发货完成后，还需要把订单状态变更为“已发货”。

最后，用户收货之后，在系统中确认收货，系统把订单状态变更为“已收货”，流程结束。

这个流程涉及到的功能模块有：**商品、购物车、订单、支付和库存，**这几个模块就是一个电商系统中的核心功能模块。

当然，仅仅有这几个模块还是不够的，因为我们只分析了“购物”这个最主要的流程，并没有完全涵盖业务需求中的全部用例，比如：**运营人员进货、老板查看报表**。

相比购物这个流程，剩下的几个用例和流程都没那么复杂，用同样的方法就可以把其他功能模块分析出来。在这里我们就省略分析过程，直接给出我们电商系统的功能模块划分：

![](https://tva1.sinaimg.cn/large/006DIypxly1h5nqn0hdo6j30wo0b4taa.jpg)

上面这个图，我使用的是 UML 中的包图 (Package Diagram) 来表示。整个系统按照功能，划分为十个模块，除了购物流程中涉及到的：商品、订单、购物车、支付、库存五个模块以外，还补充了促销、用户、账户、搜索推荐和报表这几个模块，这些都是构建一个电商系统必不可少的功能。我们一个一个来说每个模块需要实现的功能。

- 商品：维护和展示商品信息和价格。
- 订单：维护订单信息和订单状态，计算订单金额。
- 购物车：维护用户购物车中的商品。
- 支付：负责与系统内外部的支付渠道对接，实现支付功能。
- 库存：维护商品的库存数量和库存信息。
- 促销：制定促销规则，计算促销优惠。
- 用户：维护系统的用户信息，注意**用户模块它是一个业务模块，一般不负责用户登录和认证**，这是两个完全不同的功能。
- 账户：负责维护用户的账户余额。
- 搜索推荐：负责商城中，搜索商品和各种列表页和促销页的组织和展示，简单的说就是决定让用户优先看到哪些商品。
- 报表：实现统计和分析功能，生成报表，给老板来做经营分析和决策使用。

这里面需要特别说一下促销模块，它是电商系统中，最复杂的一个模块。各种优惠券、满减、返现等等这些促销规则，每个都非常复杂，再加上这些规则叠加计算，常常是复杂到连制定促销规则的人都搞不清楚。

所以每个电商公司无一例外都爆出过，因为促销规则制定失误，而产生非常便宜的“羊毛单”，让精明的消费者薅了“羊毛”。不过五花八门的促销是提升销售最有效的手段，肯定不能因噎废食。

作为系统设计者，我们需要把促销的变化和复杂性封禁在促销模块内部，不能让一个促销模块把整个电商系统都搞得非常复杂，否则就很难去设计和实现。

可行的做法是，把促销模块与其他模块的接口设计的相对简单和固定，这样系统的其他模块就不会因为新的促销玩儿法而改变。

在创建订单时，订单模块把商品和价格信息传给促销模块，促销模块返回一个可以使用的促销列表，用户选择好促销和优惠，订单模块把商品、价格、促销优惠这些信息，再次传给促销模块，促销模块则返回促销价格。

最终生成的订单中，只记录订单使用了哪几种促销，以及最终的促销价就可以了。这样，不管促销这个模块的玩儿法怎么变化，订单和其他模块的业务逻辑不需要随之改变。

## 小结

一个电商系统的设计中，最核心的几个关键点。

首先，**系统的角色是：用户、运营人员和老板**。这三个角色对电商系统的需求是：用户使用系统来购物，运营人员负责销售商品，老板关注系统中经营数据。电商系统最核心的流程就是用户购物的流程，流程从用户浏览选购商品开始，加购、下单、支付、运营人员发货、用户确认收货，至此流程结束。

细化这个流程之后，我们可以分析出，支撑这个流程几个核心的功能模块：**商品、订单、购物车、支付和库存**。此外，还需要**促销、用户、账户、搜索推荐和报表**这些必备的功能模块支撑，才能构成一个完整的电商系统。

我还和你分享了作为一个开发者，你在做需求分析的时候，需要把握的一个要点：不要一上来就设计功能，而是要先理清业务需求，也就是这节课反复强调的两个问题：**这个系统是给哪些人用的？他们分别用这个系统来解决什么问题？**这样可以确保你做出来的系统，大体上不会偏离用户的预期。

最后，在讲解系统功能模块划分的时候，我们说了一个有效减少系统复杂度的设计经验。那就是，如果系统业务是复杂而多变的，尽量识别出这部分复杂业务的边界，将复杂封禁在一个模块的内部，避免这种复杂度扩散到整个系统中去。

## Q&A

- 针对促销的话，还有一个点在实际运营的电商系统中，也需要经常考虑到。订单中要存储每个商品所均分的促销价。 比如A商品100元，B商品100元，用户买了一件A+一件B，激发了一个促销满200减10元，买个商品均摊5元，核心也是为了再做单件售后的时候，计算出首先对应的金额。退款只是我上面说的售后的一部分。售后的流程很长，先关于货物，后关于钱。实际业务比这复杂。有可能客户把东西弄的有点破损，不能退完所有的钱。
- 老师，订单关联的商品信息应该如何存储比较好。比如用户下了个订单，订单中包含了名称为A的商品，后续这个商品的名称被修改为了B，或者商品图片等等信息被修改了，但实际需求是让用户看到的订单商品信息是下单那一刻的信息，也就是名称为商品A，所以这时候应该不能直接关联现有的商品表。而且实际业务场景中可能不仅仅是这些简单的数据，可能还包含了 商品分类、商品价格信息等。所以这些数据应该如何存储比较好呢？
  - 订单快照。
- 我之前在的电信行业有三户模型，用户、客户、账户。用户是站在使用者角度，维护手机号码、sim卡号等；客户是站在自然人的角度，维护年龄、职业、性别等；账户是站在金钱角度，维护余额、专款等。 对应电商，李老师这里应该指的是客户，性别、年龄等对于消费习惯画像、深度价值挖掘的意义非常重大，是数据资产，所以不应和安全等功能性模块耦合。 可以抽象一个用户模块，维护账号、密码等鉴权数据，专职和安全认证等对接，以后扩展如第三方登录也只会影响用户模块，不会影响客户和账户。
- 一般来说是下单锁库存，发货减库存。

